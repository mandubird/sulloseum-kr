# 썰로세움 자동 발행 개발 계획서

## 1) 목표
- 배틀 결과 화면(대화 애니메이션 + 최종 결과 카드)을 쇼츠형 영상으로 자동 생성한다.
- YouTube Shorts / TikTok / X 업로드를 반자동으로 처리한다.
- 최종 게시 버튼 클릭은 운영자가 직접 수행한다.

## 2) 범위 (In Scope)
- 배틀 ID 기준 영상 생성 파이프라인 구축
- 플랫폼별 업로드 직전 단계(영상 첨부, 캡션 입력, 해시태그 삽입) 자동화
- 실패 로그, 재시도, 결과 리포트
- 수동 최종 발행 체크리스트

## 3) 비범위 (Out of Scope)
- 완전 무인 자동 게시(최종 게시까지 자동 클릭)
- CAPTCHA/2FA 우회
- 플랫폼 정책 위반 가능성이 있는 비공식 우회 자동화

## 4) 산출물
- `scripts/render-battle-video.ts`
  - 배틀 URL을 로드해 쇼츠 규격(9:16) MP4 생성
- `scripts/prepare-publish.ts`
  - 플랫폼별 캡션/해시태그/제목 생성
- `scripts/open-publish-session.ts`
  - 플랫폼 업로드 화면까지 자동 진입 및 입력
- `outputs/videos/*.mp4`
- `outputs/metadata/*.json`
- `outputs/reports/publish-report-YYYYMMDD.md`

## 5) 기술 접근
### A. 영상화
- 방식: 화면 기반 렌더(브라우저 자동 재생 캡처)
- 출력: `1080x1920`, `H.264`, `30fps`, 플랫폼 길이 제한 내 클립
- 검증: 무음/폰트 깨짐/프레임 드랍/첫·끝 장면 누락 체크

### B. 반자동 업로드
- YouTube Shorts: 제목/설명/해시태그/썸네일/영상 첨부 자동 입력, 게시 클릭은 수동
- TikTok: 영상+캡션 입력 자동화, 게시 클릭은 수동
- X: 영상 첨부+본문 입력 자동화, Post 클릭은 수동

## 6) 일정
### 1단계: MVP (3~5일)
- 배틀 1건 영상 생성
- 3개 채널 업로드 화면 자동 입력
- 최종 클릭 전 대기 상태까지 구현

### 2단계: 안정화 (+2~4일)
- 실패 재시도, 로그, 체크리스트, 파일 규격 검증
- 캡션 템플릿 다변화

### 3단계: 운영화 (총 2~3주)
- 일괄 생성(여러 배틀), 스케줄링, 운영 리포트
- 계정/세션 관리 표준화

## 7) 운영 플로우
1. 배틀 선택(게시판 기준)
2. 영상 생성
3. 캡션/해시태그 자동 생성
4. 플랫폼별 업로드 화면 자동 입력
5. 운영자 최종 검수
6. 운영자 수동 게시 클릭
7. 발행 로그 저장

## 8) 품질 기준 (Definition of Done)
- 영상이 세 플랫폼 업로드 규격 검사 통과
- 업로드 직전 화면까지 자동 진입 성공
- 게시 버튼 직전에서 운영자에게 명확히 제어권 전달
- 발행/실패 로그가 리포트로 남음

## 9) 리스크 및 대응
- 플랫폼 UI 변경: 셀렉터 관리 파일 분리 + 주기 점검
- 로그인 만료/2FA: 사전 로그인 체크 단계 고정
- 렌더 시간 증가: 큐 처리 + 병렬 제한
- 정책 리스크: 공식 정책 범위 내 반자동만 유지

## 10) 실행 준비 체크리스트
- 운영 계정 로그인 상태 확인
- 테스트용 배틀 ID 목록 준비
- 샘플 3건(짧음/중간/긴 대사) 렌더 검수
- 플랫폼별 업로드 직전 화면 도달 리허설

## 11) 성공 지표 (초기)
- 영상 생성 성공률 95%+
- 업로드 직전 자동화 성공률 90%+
- 건당 준비 시간(영상~업로드 대기) 10분 이내

---

## 12) 실행 방법 (MVP)

**사전:** 로컬에서 `npm run dev` 또는 배포 URL에서 서버 가동. Chromium 설치: `npx playwright install chromium`

1. **영상 생성**  
   `npm run render-video -- <battleId> [baseUrl]`  
   예: `npm run render-video -- abc123` (localhost:3000)  
   예: `npm run render-video -- abc123 https://www.ssulo.com`  
   → `outputs/videos/<battleId>.webm` 생성

2. **캡션/메타 생성**  
   `npm run prepare-publish -- <battleId> [baseUrl]`  
   → `outputs/metadata/<battleId>-publish.json` 생성

3. **업로드 화면 열기**  
   `npm run open-publish -- <battleId>`  
   → 브라우저가 열리고 YouTube/TikTok/X 탭에 제목·캡션·영상 입력 시도. **최종 게시는 수동 클릭**

